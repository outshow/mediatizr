(function(def){if(typeof define=="function"){define(def)}else if(typeof module!="undefined"){module.exports=def}else{this.Sheethub=def}})(function(){var doc=document,getElementsByTagName="getElementsByTagName",head=doc[getElementsByTagName]("head")[0],removeChild="removeChild",parentNode="parentNode",stylesheets={},ready=false,listeners=[],sheetsToLoad=0,node,nodes=[],links=doc[getElementsByTagName]("link"),styles=doc[getElementsByTagName]("style"),a,b,callback=function(){if(!--sheetsToLoad){ready=true;var i=listeners.length;while(i){listeners[--i]()}}},Stylesheet=function(stylesheet){var node,ready=false,listeners=[],contents,appendChild="appendChild",styleSheet="styleSheet",a,createNewNode=function(){head[appendChild](node=doc.createElement("style"));if(!node[styleSheet]){node[appendChild](doc.createTextNode(""))}},complete=function(){ready=true;a=listeners.length;while(a){listeners[--a]()}},Stylesheet={listen:function(callback){listeners.push(callback)},ready:function(){return ready},set:function(text){if(node.tagName=="LINK"){node[parentNode][removeChild](node);createNewNode()}if(node[styleSheet]){node[styleSheet].cssText=text}else{node.firstChild.nodeValue=text}contents=text},get:function(){return contents},node:function(){return node}},isDOMReady=function(){if(head){if(typeof stylesheet=="object"){node=stylesheet;if(node.tagName=="LINK"){if(this.XMLHttpRequest){a=new XMLHttpRequest}else{a=new ActiveXObject("Microsoft.XMLHTTP")}a.open("GET",node.href,true);a.onreadystatechange=function(){if(a.readyState==4){contents=a.responseText.replace(/\.\.\//g,"");complete()}};a.send(null)}else{contents=node[styleSheet]?node[styleSheet].cssText:node.innerHTML}}else{createNewNode();if(typeof stylesheet=="string"){Stylesheet.set(stylesheet)}complete()}}else{setTimeout(isDOMReady,250)}};isDOMReady();return Stylesheet},Sheethub={listen:function(callback){listeners.push(callback)},ready:function(){return ready},list:function(){return stylesheets},has:function(id){return stylesheets[id]},add:function(id,contents){if(!Sheethub.has(id)){stylesheets[id]=new Stylesheet(contents)}},get:function(id){if(!id){return stylesheets}if(Sheethub.has(id)){return stylesheets[id]}},remove:function(id){if(Sheethub.has(id)){a=stylesheets[id].node();a[parentNode][removeChild](a);delete stylesheets[id]}}};a=-1;while(b=links[++a]){if(b.rel.toLowerCase()=="stylesheet"){nodes.push(b);++sheetsToLoad}}a=styles.length;while(a){nodes.push(styles[--a])}a=-1;while(node=nodes[++a]){if(!(b=node.title)&&node.href){b="sheet"+Math.round(Math.random()*9e3+1e3)}if(b){Sheethub.add(b,node);if(stylesheets[b].ready()){callback()}else{stylesheets[b].listen(callback)}}}return Sheethub}());
!function(e,t){"undefined"!=typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.W=t()}(this,function(){var e,t,n=window,i=document,o=i.documentElement,d=[],r=function(e){return function(){o.clientWidth&&e()}};return function(f){var u,h,l,s=typeof f;return"function"==s?((h=n.addEventListener)?h("resize",r(f),!1):n.attachEvent("onresize",r(f)),d.length||(e=i.createElement("b"),e.style.position="absolute",e.style.top="-99em",e.innerHTML="W",o.appendChild(e),t=e.offsetHeight,setInterval(function(n,i){if(t!=(i=e.offsetHeight))for(n=d.length;n;)r(d[--n])();t=i},250)),void d.push(f)):(h=i.createElement("div"),h.style.width="1em",o.appendChild(h),u=h.offsetWidth,u=u?u:16,o.removeChild(h),"number"==s?f/u:(h=navigator.userAgent.match(/iPhone|iPod|iPad/i)?n.outerWidth:screen.width,(l=n.innerWidth)||(l=o.clientWidth),h=5>100*(l-h)/l?l:h,f?h/u:h))}});
(function(){

    var win=window,
        doc=document,
        html=doc.documentElement,
        Sheethub=win.Sheethub,
        id='mediatizr',
        get='get',
        node='node',
        element,
        mediatizr=function(){

            var sheets=Sheethub[get](),
                sheet,
                stylesheets={},
                name,
                nod,
                contents,
                start,
                end,
                mq,
                index,
                indexOf='indexOf',
                i,
                /*
                    Evaluate media queries and show stylesheets
                */
                evalMedias=function(){
                    var i,j,condition,conditions,current,required;
                    // Browse registered stylesheets
                    for(i in stylesheets){
                        // Evaluate expression
                        conditions=stylesheets[i].split('and');
                        j=-1;
                        while(conditions[++j]){
                            // Extract data
                            condition=conditions[j].match(/\(\s*(.+?)\s*:\s*(.+?)(px|em)\s*\)/);
                            current=W(condition[3]=='em');
                            required=condition[2];
                            // Enable/disable stylesheet
                            Sheethub[get](i)[node]().disabled=
                                !condition[1][indexOf]('min')?
                                current<required:
                                current>required;
                        }
                    }
                },
                /*
                    Search a corresponding closed bracket

                    Return
                        integer
                */
                indexOfMatchedBracket=function(contents){
                    var open,
                        close,
                        index=0,
                        brackets=0;
                    // Loop until brackets are found
                    while(open!=-1 || close!=-1){
                        // Search brackets
                        open=contents[indexOf]('{',index);
                        close=contents[indexOf]('}',index);
                        // Open
                        if(close>open && open!=-1){
                            ++brackets;
                            index=open+1;
                        }
                        // Close
                        else{
                            --brackets;
                            index=close+1;
                        }
                        // Matching closing bracket found!
                        if(!brackets){
                            return close;
                        }
                    }
                    return -1;
                };

            // Register media queries
            i=0;
            for(sheet in sheets){
                if(!sheet.match('^'+id)){
                    contents=sheets[sheet][get]();
                    index=0;
                    // A new media query was found
                    while((start=contents[indexOf]('@media',index))!=-1){
                        // Search corresponding close bracket
                        end=indexOfMatchedBracket(contents.substr(start));
                        // Extract data
                        if(mq=contents.substr(start+6,end-4).match(/([\S\s]+?)and([\S\s]+?)\{([\S\s]+)/i)){
                            // Create the new stylesheet
                            Sheethub.add(name=id+(++i)+sheet,mq[3]);
                            nod=Sheethub[get](name)[node]();
                            // Define media type
                            nod.media=mq[1];
                            // Register this stylesheet
                            stylesheets[name]=(mq[2]+'').toLowerCase();
                            // Disable it for the time
                            nod.disabled=true;
                        }
                        // Update index
                        index=start+end;
                    }
                }
            }

            // Catch responsive events
            W(evalMedias);
            evalMedias();

        };

    // Test if media queries are supported or not
    if(!(win.supportMediaQueries=function(){
        if(win.matchMedia){
            return true;
        }
        element=doc.createElement('p');
        element.id=id;
        element.style.position='absolute';
        element.style.top='-99em';
        html.appendChild(element);
        Sheethub.add(id,'#'+id+'{width:9px}');
        Sheethub[get](id)[node]().media='only all';
        return element.offsetWidth==9 &&
               !Sheethub.remove(id) &&
               !!html.removeChild(element);
    }())){
        // Launch script
        if(Sheethub.ready()){
            mediatizr();
        }
        else{
            Sheethub.listen(mediatizr);
        }
    }

})();
