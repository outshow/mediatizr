(function(def){if(typeof define=="function"){define(def)}else if(typeof module!="undefined"){module.exports=def}else{this.Sheethub=def}})(function(){var doc=document,getElementsByTagName="getElementsByTagName",head=doc[getElementsByTagName]("head")[0],removeChild="removeChild",parentNode="parentNode",stylesheets={},ready=false,listeners=[],sheetsToLoad=0,node,nodes=[],links=doc[getElementsByTagName]("link"),styles=doc[getElementsByTagName]("style"),a,b,callback=function(){if(!--sheetsToLoad){ready=true;var i=listeners.length;while(i){listeners[--i]()}}},Stylesheet=function(stylesheet){var node,ready=false,listeners=[],contents,appendChild="appendChild",styleSheet="styleSheet",a,createNewNode=function(){head[appendChild](node=doc.createElement("style"));if(!node[styleSheet]){node[appendChild](doc.createTextNode(""))}},complete=function(){ready=true;a=listeners.length;while(a){listeners[--a]()}},Stylesheet={listen:function(callback){listeners.push(callback)},ready:function(){return ready},set:function(text){if(node.tagName=="LINK"){node[parentNode][removeChild](node);createNewNode()}if(node[styleSheet]){node[styleSheet].cssText=text}else{node.firstChild.nodeValue=text}contents=text},get:function(){return contents},node:function(){return node}},isDOMReady=function(){if(head){if(typeof stylesheet=="object"){node=stylesheet;if(node.tagName=="LINK"){if(this.XMLHttpRequest){a=new XMLHttpRequest}else{a=new ActiveXObject("Microsoft.XMLHTTP")}a.open("GET",node.href,true);a.onreadystatechange=function(){if(a.readyState==4){contents=a.responseText.replace(/\.\.\//g,"");complete()}};a.send(null)}else{contents=node[styleSheet]?node[styleSheet].cssText:node.innerHTML}}else{createNewNode();if(typeof stylesheet=="string"){Stylesheet.set(stylesheet)}complete()}}else{setTimeout(isDOMReady,250)}};isDOMReady();return Stylesheet},Sheethub={listen:function(callback){listeners.push(callback)},ready:function(){return ready},list:function(){return stylesheets},has:function(id){return stylesheets[id]},add:function(id,contents){if(!Sheethub.has(id)){stylesheets[id]=new Stylesheet(contents)}},get:function(id){if(!id){return stylesheets}if(Sheethub.has(id)){return stylesheets[id]}},remove:function(id){if(Sheethub.has(id)){a=stylesheets[id].node();a[parentNode][removeChild](a);delete stylesheets[id]}}};a=-1;while(b=links[++a]){if(b.rel.toLowerCase()=="stylesheet"){nodes.push(b);++sheetsToLoad}}a=styles.length;while(a){nodes.push(styles[--a])}a=-1;while(node=nodes[++a]){if(!(b=node.title)&&node.href){b="sheet"+Math.round(Math.random()*9e3+1e3)}if(b){Sheethub.add(b,node);if(stylesheets[b].ready()){callback()}else{stylesheets[b].listen(callback)}}}return Sheethub}());